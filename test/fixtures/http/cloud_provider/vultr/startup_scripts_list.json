{"542959":{"SCRIPTID":"542959","date_created":"2019-06-05 00:10:45","date_modified":"2019-08-06 15:37:14","name":"init base debian","type":"boot","script":"#!/bin/sh\n\n\napt-get update\n\n#####\n# nginx:\n#####\nyes | apt install nginx\n\n# for apt https support:\nyes | apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg2 \\\n    nodejs \\\n    unzip \\\n    software-properties-common\n\n# make copy of nginx conf\ncp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig\nln -s /usr/bin/nodejs /usr/bin/node\n\n#####\n# Docker and docker-compose\n#####\n\n# add docker repository\ncurl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -\nadd-apt-repository \n   \"deb [arch=amd64] https://download.docker.com/linux/debian \n   $(lsb_release -cs) \n   stable\"\n\n# install docker:\napt-get update\nyes | apt-get install docker-ce docker-ce-cli containerd.io\n\n# install docker-compose:\ncurl -L \"https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/bin/docker-compose\nchmod +x /usr/bin/docker-compose\n\n# build docker compose\nmkdir -p /root/openode-www/deployment/dind-with-docker-compose/\necho 'FROM docker:dind' \u003e /root/openode-www/deployment/dind-with-docker-compose/Dockerfile\necho 'RUN apk add --no-cache py-pip python-dev libffi-dev openssl-dev gcc libc-dev make' \u003e\u003e /root/openode-www/deployment/dind-with-docker-compose/Dockerfile\necho 'RUN pip install docker-compose' \u003e\u003e /root/openode-www/deployment/dind-with-docker-compose/Dockerfile\necho 'will build dind'\ncd /root/openode-www/deployment/dind-with-docker-compose/ \u0026\u0026 docker build -t dind-with-docker-compose .\necho 'done to build dind'\n\necho \"openode-ready\" \u003e /var/www/html/index.nginx-debian.html\n\n#####\n# auto updates\n#####\n\napt -y install unattended-upgrades\necho \"\" \u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'APT::Periodic::Update-Package-Lists \"1\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'APT::Periodic::Download-Upgradeable-Packages \"1\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'APT::Periodic::AutocleanInterval \"7\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'APT::Periodic::Unattended-Upgrade \"1\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\n\necho '// Automatically upgrade packages from these ' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'Unattended-Upgrade::Origins-Pattern {' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '      \"o=Debian,a=stable\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '      \"o=Debian,a=stable-updates\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '      \"o=Debian,a=proposed-updates\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\n      echo '\"origin=Debian,codename=${distro_codename},label=Debian-Security\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '};' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\n\necho '// You can specify your own packages to NOT automatically upgrade here' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho 'Unattended-Upgrade::Package-Blacklist {' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '      \"docker.io\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\necho '};' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\n\necho 'Unattended-Upgrade::Automatic-Reboot \"false\";' \u003e\u003e /etc/apt/apt.conf.d/50unattended-upgrades\n\n#####\n# boot welcome message\n#####\n\nyes | apt install screenfetch\necho \"\" \u003e /etc/motd\n\necho \"#!/bin/sh\" \u003e /etc/update-motd.d/01-custom\necho \"df -h\" \u003e\u003e /etc/update-motd.d/01-custom\necho \"echo\" \u003e\u003e /etc/update-motd.d/01-custom\necho \"echo\" \u003e\u003e /etc/update-motd.d/01-custom\necho \"screenfetch\" \u003e\u003e /etc/update-motd.d/01-custom\necho \"echo\" \u003e\u003e /etc/update-motd.d/01-custom\necho \"echo\" \u003e\u003e /etc/update-motd.d/01-custom\nchmod +x /etc/update-motd.d/01-custom\n\necho \"echo 'Powered by opeNode.io'\" \u003e\u003e /etc/update-motd.d/01-custom"}}